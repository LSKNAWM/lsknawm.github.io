<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>abc</title>
      <link href="/2023/10/03/abcdefg/"/>
      <url>/2023/10/03/abcdefg/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>test</title>
      <link href="/2023/10/03/test/"/>
      <url>/2023/10/03/test/</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service<span class="token key atrule">metadata</span><span class="token punctuation">:</span>  <span class="token key atrule">name</span><span class="token punctuation">:</span> gitlab<span class="token key atrule">spec</span><span class="token punctuation">:</span>  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort  <span class="token key atrule">ports</span><span class="token punctuation">:</span>  <span class="token comment"># Port上的映射端口</span>  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">443</span>    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">443</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> gitlab443  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> gitlab80  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">22</span>    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">22</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> gitlab22  <span class="token key atrule">selector</span><span class="token punctuation">:</span>    <span class="token key atrule">app</span><span class="token punctuation">:</span> gitlab <span class="token punctuation">---</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment<span class="token key atrule">metadata</span><span class="token punctuation">:</span>  <span class="token key atrule">name</span><span class="token punctuation">:</span> gitlab<span class="token key atrule">spec</span><span class="token punctuation">:</span>  <span class="token key atrule">selector</span><span class="token punctuation">:</span>    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>      <span class="token key atrule">app</span><span class="token punctuation">:</span> gitlab  <span class="token key atrule">revisionHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">2</span>  <span class="token key atrule">template</span><span class="token punctuation">:</span>    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>      <span class="token key atrule">labels</span><span class="token punctuation">:</span>        <span class="token key atrule">app</span><span class="token punctuation">:</span> gitlab    <span class="token key atrule">spec</span><span class="token punctuation">:</span>      <span class="token key atrule">containers</span><span class="token punctuation">:</span>      <span class="token comment"># 应用的镜像</span>      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> gitlab/gitlab<span class="token punctuation">-</span>ce         <span class="token key atrule">name</span><span class="token punctuation">:</span> gitlab        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent        <span class="token comment"># 应用的内部端口</span>        <span class="token key atrule">ports</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">443</span>          <span class="token key atrule">name</span><span class="token punctuation">:</span> gitlab443        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>          <span class="token key atrule">name</span><span class="token punctuation">:</span> gitlab80        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">22</span>          <span class="token key atrule">name</span><span class="token punctuation">:</span> gitlab22        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>        <span class="token comment"># gitlab持久化</span>        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> gitlab<span class="token punctuation">-</span>persistent<span class="token punctuation">-</span>config          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/gitlab        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> gitlab<span class="token punctuation">-</span>persistent<span class="token punctuation">-</span>logs          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/log/gitlab        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> gitlab<span class="token punctuation">-</span>persistent<span class="token punctuation">-</span>data          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/opt/gitlab      <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> devops<span class="token punctuation">-</span>repo      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token comment"># 使用nfs互联网存储</span>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> gitlab<span class="token punctuation">-</span>persistent<span class="token punctuation">-</span>config        <span class="token key atrule">nfs</span><span class="token punctuation">:</span>          <span class="token key atrule">server</span><span class="token punctuation">:</span> 192.168.17.81          <span class="token key atrule">path</span><span class="token punctuation">:</span> /home/k8s<span class="token punctuation">-</span>nfs/gitlab/config      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> gitlab<span class="token punctuation">-</span>persistent<span class="token punctuation">-</span>logs        <span class="token key atrule">nfs</span><span class="token punctuation">:</span>          <span class="token key atrule">server</span><span class="token punctuation">:</span> 192.168.17.81          <span class="token key atrule">path</span><span class="token punctuation">:</span> /home/k8s<span class="token punctuation">-</span>nfs/gitlab/logs      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> gitlab<span class="token punctuation">-</span>persistent<span class="token punctuation">-</span>data        <span class="token key atrule">nfs</span><span class="token punctuation">:</span>          <span class="token key atrule">server</span><span class="token punctuation">:</span> 192.168.17.81          <span class="token key atrule">path</span><span class="token punctuation">:</span> /home/k8s<span class="token punctuation">-</span>nfs/gitlab/data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>在 nfs 服务器创建共享目录，部署的 gitlib 使用共享目录来进行持久化</title>
      <link href="/2023/10/03/k8s-bu-shu-gitlab-deployment-ji-yu-nfs-jin-xing-shu-ju-chi-jiu-hua-xue-liang-bian-cheng-shou-ji-de-bo-ke-csdn-bo-ke/"/>
      <url>/2023/10/03/k8s-bu-shu-gitlab-deployment-ji-yu-nfs-jin-xing-shu-ju-chi-jiu-hua-xue-liang-bian-cheng-shou-ji-de-bo-ke-csdn-bo-ke/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文由 <a href="http://ksria.com/simpread/">简悦 SimpRead</a> 转码， 原文地址 <a href="https://blog.csdn.net/a772304419/article/details/126622063">blog.csdn.net</a></p></blockquote><h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h2 id="1-1-创建-nfs-共享目录"><a href="#1-1-创建-nfs-共享目录" class="headerlink" title="1.1 创建 nfs 共享目录"></a>1.1 创建 <a href="https://so.csdn.net/so/search?q=nfs&amp;spm=1001.2101.3001.7020">nfs</a> 共享目录</h2><p>在 nfs 服务器创建共享目录，部署的 gitlib 使用共享目录来进行持久化，这样不管在哪个节点运行 gitlib 都没有关系。</p><pre class="line-numbers language-none"><code class="language-none"># mkdir -p /home/k8s-nfs/gitlab/config# mkdir -p /home/k8s-nfs/gitlab/logs# mkdir -p /home/k8s-nfs/gitlab/data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="1-2-添加到共享"><a href="#1-2-添加到共享" class="headerlink" title="1.2 添加到共享"></a>1.2 添加到共享</h2><pre class="line-numbers language-none"><code class="language-none">vim /etc/exports/home/k8s-nfs/gitlab/config 192.168.17.0/8(rw,no_root_squash)/home/k8s-nfs/gitlab/logs 192.168.17.0/8(rw,no_root_squash)/home/k8s-nfs/gitlab/data 192.168.17.0/8(rw,no_root_squash)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="1-3-执行更新"><a href="#1-3-执行更新" class="headerlink" title="1.3 执行更新"></a>1.3 执行更新</h2><pre class="line-numbers language-none"><code class="language-none"># service nfs restart或者# exportfs -r<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><script async="" src="//www.imageoss.com/sdk/pup.js" data-url="https://www.imageoss.com/upload"></script><h1 id="部署-gitlib"><a href="#部署-gitlib" class="headerlink" title="部署 gitlib"></a>部署 gitlib</h1><h2 id="2-1-准备部署文件（gitlib-deploy-yaml）"><a href="#2-1-准备部署文件（gitlib-deploy-yaml）" class="headerlink" title="2.1 准备部署文件（gitlib-deploy.yaml）"></a>2.1 准备部署文件（gitlib-deploy.yaml）</h2><pre class="line-numbers language-none"><code class="language-none">apiVersion: v1kind: Servicemetadata:  name: gitlabspec:  type: NodePort  ports:  # Port上的映射端口  - port: 443    targetPort: 443    name: gitlab443  - port: 80    targetPort: 80    name: gitlab80  - port: 22    targetPort: 22    name: gitlab22  selector:    app: gitlab --- apiVersion: apps/v1kind: Deploymentmetadata:  name: gitlabspec:  selector:    matchLabels:      app: gitlab  revisionHistoryLimit: 2  template:    metadata:      labels:        app: gitlab    spec:      containers:      # 应用的镜像      - image: gitlab/gitlab-ce         name: gitlab        imagePullPolicy: IfNotPresent        # 应用的内部端口        ports:        - containerPort: 443          name: gitlab443        - containerPort: 80          name: gitlab80        - containerPort: 22          name: gitlab22        volumeMounts:        # gitlab持久化        - name: gitlab-persistent-config          mountPath: /etc/gitlab        - name: gitlab-persistent-logs          mountPath: /var/log/gitlab        - name: gitlab-persistent-data          mountPath: /var/opt/gitlab      imagePullSecrets:      - name: devops-repo      volumes:      # 使用nfs互联网存储      - name: gitlab-persistent-config        nfs:          server: 192.168.17.81          path: /home/k8s-nfs/gitlab/config      - name: gitlab-persistent-logs        nfs:          server: 192.168.17.81          path: /home/k8s-nfs/gitlab/logs      - name: gitlab-persistent-data        nfs:          server: 192.168.17.81          path: /home/k8s-nfs/gitlab/data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-2-执行部署"><a href="#2-2-执行部署" class="headerlink" title="2.2 执行部署"></a>2.2 执行部署</h2><pre class="line-numbers language-none"><code class="language-none"># kubectl apply -f gitlib-deploy.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-3-查看部署结果"><a href="#2-3-查看部署结果" class="headerlink" title="2.3 查看部署结果"></a>2.3 查看部署结果</h2><pre class="line-numbers language-none"><code class="language-none"># kubectl get deploy NAME     READY   UP-TO-DATE   AVAILABLE   AGEgitlab   1/1     1            1           134m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>以上说明部署完成。</p><h1 id="gitlib-初始化"><a href="#gitlib-初始化" class="headerlink" title="gitlib 初始化"></a>gitlib 初始化</h1><h2 id="3-1-访问登录页面"><a href="#3-1-访问登录页面" class="headerlink" title="3.1 访问登录页面"></a>3.1 访问登录页面</h2><p>通过查看 service 映射的端口：</p><pre class="line-numbers language-none"><code class="language-none"># kubectl get svc -o wideNAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                                   AGE    SELECTORgitlab       NodePort    10.10.129.28    &lt;none&gt;        443:31326/TCP,80:31320/TCP,22:31515/TCP   137m   app=gitlab<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到映射 80 端口的节点端口为：31320</p><p>通过指定端口访问登录页：</p><p><img src="https://img-blog.csdnimg.cn/62951a1a0eb344ce9d1cf0d8c7a941d1.png"></p><h2 id="3-2-初始用户名和密码"><a href="#3-2-初始用户名和密码" class="headerlink" title="3.2 初始用户名和密码"></a>3.2 初始用户名和密码</h2><p>初始用户名为 root，初始密码 gitlib 自动创建，在如下文件中：</p><pre class="line-numbers language-none"><code class="language-none">cat /etc/gitlab/initial_root_password<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>由于是容器部署，所以，需要进入到容器中，找到对应文件，拷贝密码进行登录。文件内容类似：</p><pre class="line-numbers language-none"><code class="language-none"># WARNING: This value is valid only in the following conditions# 1. If provided manually (either via `GITLAB_ROOT_PASSWORD` environment variable or via `gitlab_rails['initial_root_passwo# 2. Password hasn't been changed manually, either via UI or via command line.## If the password shown here doesn't work, you must reset the admin password following https://docs.gitlab.com/ee/security/Password: HCsr5VFAp28N*****************=# NOTE: This file will be automatically deleted in the first reconfigure run after 24 hours.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>参考链接：<a href="https://blog.csdn.net/m0_52544877/article/details/125448793">https://blog.csdn.net/m0_52544877/article/details/125448793</a></p>]]></content>
      
      
      <categories>
          
          <category> kubernetes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kubernetes </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
